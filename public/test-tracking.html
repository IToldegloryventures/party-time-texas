<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Party Time Texas - NFC Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #000;
        color: #fff;
      }
      .header {
        text-align: center;
        margin-bottom: 40px;
      }
      .tracking-info {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .button {
        background: linear-gradient(45deg, #ff1e56, #ff00ff, #00ffff);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px;
      }
      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        background: #2d5a2d;
      }
      .error {
        background: #5a2d2d;
      }
      .info {
        background: #2d4a5a;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üéâ Party Time Texas</h1>
      <p>NFC Scan Tracking Test</p>
    </div>

    <div class="tracking-info">
      <h3>üìä Scan Tracking Status</h3>
      <div id="status" class="status info">Ready to track scans...</div>
      <p><strong>Device ID:</strong> 04:70:94:EA:9F:20:90</p>
      <p><strong>Tracking URL:</strong> <span id="trackingUrl"></span></p>
    </div>

    <div style="text-align: center">
      <button class="button" onclick="simulateScan()">
        üîç Simulate NFC Scan
      </button>
      <button class="button" onclick="checkScans()">üìà Check Scan Count</button>
    </div>

    <div id="results" style="margin-top: 20px"></div>

    <script>
      const DEVICE_ID = '04:70:94:EA:9F:20:90';
      const TRACKING_URL = 'http://192.168.0.178:3000/api/track-scan';

      document.getElementById('trackingUrl').textContent = TRACKING_URL;

      function simulateScan() {
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = 'Tracking scan...';
        statusDiv.className = 'status info';

        const metadata = {
          location: null,
          utm: {
            utm_source: 'test',
            utm_medium: 'nfc',
            utm_campaign: 'party_time_texas',
          },
          referrer: 'https://lnk.bio/PartyTimeTexas',
          timestamp: new Date().toISOString(),
          page: window.location.href,
        };

        fetch(TRACKING_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            deviceId: DEVICE_ID,
            scanType: 'nfc_tap',
            metadata: metadata,
          }),
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              statusDiv.textContent = '‚úÖ Scan tracked successfully!';
              statusDiv.className = 'status success';
              document.getElementById('results').innerHTML =
                '<div class="tracking-info"><h3>üéâ Success!</h3><p>Scan ID: ' +
                data.scanId +
                '</p><p>Message: ' +
                data.message +
                '</p></div>';
            } else {
              statusDiv.textContent = '‚ùå Error: ' + data.error;
              statusDiv.className = 'status error';
            }
          })
          .catch(error => {
            statusDiv.textContent = '‚ùå Network Error: ' + error.message;
            statusDiv.className = 'status error';
            console.error('Error:', error);
          });
      }

      function checkScans() {
        fetch(TRACKING_URL + '?deviceId=' + DEVICE_ID)
          .then(response => response.json())
          .then(data => {
            document.getElementById('results').innerHTML =
              '<div class="tracking-info"><h3>üìä Scan Analytics</h3><p><strong>Total Scans:</strong> ' +
              data.totalScans +
              '</p><p><strong>Recent Scans:</strong> ' +
              JSON.stringify(data.scans.slice(0, 3), null, 2) +
              '</p></div>';
          })
          .catch(error => {
            document.getElementById('results').innerHTML =
              '<div class="tracking-info"><h3>‚ùå Error</h3><p>Could not fetch scan data: ' +
              error.message +
              '</p></div>';
          });
      }

      // Auto-track when page loads (simulating NFC scan)
      window.addEventListener('load', function () {
        setTimeout(simulateScan, 1000);
      });
    </script>
  </body>
</html>
